@using MyPage.Application.Helpers;
@using MyPage.Application.Models.Pages;
@model ProjectsPageModel

<div class="modal" id="modal">
    <div class="modal-internal" onclick="closeVideoModel()">
        <iframe class="video"
                id="video"
                width="560"
                height="315"
                src=""
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen>
        </iframe>
    </div>
</div>
<div class="projects-external-container">
    <form asp-action="Index" method="get" class="search-form">
        <div class="search-container">
            <input class="search-box" type="text" name="SearchFilter" value="@ViewData["SearchFilter"]" placeholder="@LanguageResource["SearchDefaultText"]" />
            <input type="hidden" name="tagFilter" value="@ViewData["TagFilter"]" id="tagFilter" />
            <div class="search-buttons">
                <input type="submit" value="" class="search-button" />
                <a asp-action="Index" class="clear-filter-button"></a>
            </div>
        </div>
        <div class="tag-list">
            @foreach (var tag in Model.TagList)
            {
                if (tag.SelectedToFilter)
                {
                    <div id="@tag.TagName" class="project-tag-search tag-selected" onclick="addOrRemoveSelectedTag('@tag.TagName')">@tag.TagName</div>
                }
                else
                {
                    <div id="@tag.TagName" class="project-tag-search" onclick="addOrRemoveSelectedTag('@tag.TagName')">@tag.TagName</div>
                }
            }
        </div>
    </form>
    <div class="projects-container">
        @foreach (var project in Model.ProjectList)
        {
            <div class="project">
                <div class="project-content">
                    <div class="project-header">
                        <span class="project-title">@project.Title</span>
                        <div class="project-tags">
                            @foreach (var tag in project.CustomProperties.Tags)
                            {
                                <div class="project-tag">@tag</div>
                            }
                        </div>
                    </div>
                    <div class="project-body">
                        <div class="project-mini-description">@project.CustomProperties.Description</div>
                        <div class="project-links">
                            <div class="project-link" onclick="window.open('@project.Url','github')">
                                <span>github</span>
                                <img src="~/img/out.png" />
                            </div>
                            <div class="project-link" onclick="openVideoModel('@project.CustomProperties.VideoUrl')">
                                <span>ver vídeo</span>
                                <img src="~/img/play.png" style="height: 13px" />
                            </div>
                        </div>
                    </div>
                </div>
                <div class="project-bar"></div>
            </div>
        }
    </div>
</div>

<style>
    .modal {
        display: none;
        position: fixed;
        height: 100%;
        width: 100%;
        background: rgba(0, 0, 0, 0.8);
        opacity: 0;
        z-index: 10000;
        transition: opacity .3s linear;
    }

    .modal-internal {
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100%;
        width: 100%;
    }

    .video {
        border: solid 0.5px #18181c;
        background-repeat: no-repeat;
        background-attachment: fixed;
        background-position: center;
        background-color: #18181c;
        background-image: url("/img/loading.gif");
        background-size: 50px;
    }

    .search-container {
        display: flex;
        height: 25px;
        align-items: center;
        justify-content: center;
        margin: 0 30%;
        width: -moz-available;
        width: -webkit-fill-available;
        width: fill-available;
        max-width: 600px;
        min-width: 390px;
        gap: 15px;
    }

    .search-form {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 40px;
        width: 100%;
    }

    .search-buttons {
        display: flex;
        gap: 17px;
    }

    .search-button {
        padding: 0;
        background-color: transparent;
        height: 25px;
        width: 26px;
        border: none;
        cursor: pointer;
        background-image: url(/img/loupe.png);
        background-repeat: no-repeat;
        background-position: center center;
        background-size: 25px;
        transition: background-image .2s linear;
    }

        .search-button:active, .search-button:hover, .search-button:focus {
            background-image: url(/img/loupe-active.png);
        }

    .clear-filter-button {
        height: 25px;
        width: 26px;
        cursor: pointer;
        background-image: url(/img/close.png);
        background-repeat: no-repeat;
        background-position: center center;
        background-size: 24px;
        transition: background-image .2s linear;
    }

        .clear-filter-button:active, .clear-filter-button:hover, .clear-filter-button:focus {
            background-image: url(/img/close-active.png);
        }

    .search-box {
        background-color: transparent;
        border: none;
        width: 100%;
        height: 20px;
        padding-top: 5px;
        padding-bottom: 5px;
        color: #ffffffa3;
        font-size: 15px;
        outline: none;
        border-bottom: 2px solid #1f1f2a;
        transition: border-bottom .2s linear;
    }

    .tag-list {
        display: flex;
        flex-direction: row;
        overflow-y: hidden;
        gap: 7px;
        /*height: 30px;*/
        margin: 0 25%;
        width: -moz-available;
        width: -webkit-fill-available;
        width: fill-available;
        padding-bottom: 18px;
        max-width: 750px;
        min-width: 485px;
        overflow: -moz-scrollbars-vertical;
        overflow-x: scroll;
    }

        .tag-list::-webkit-scrollbar {
            height: 12px;
        }

        .tag-list::-webkit-scrollbar-track {
            background: #0d0e12;
            border-radius: 10px;
            margin: 0 0px;
        }

        .tag-list::-webkit-scrollbar-thumb {
            background-color: #444456;
            border-radius: 20px;
            border: 3px solid #0d0e12;
        }

    .project-tag-search {
        font-size: 12px;
        border-radius: 30px;
        background-color: #232332;
        padding: 3px 7px;
        border: 1px solid #4c4d5e;
        opacity: 0.8;
        height: 20px;
        display: flex;
        align-items: center;
        white-space: nowrap;
        cursor: pointer;
        user-select: none;
        transition: border .2s linear, opacity .2s linear, background-color .2s linear;
    }
    
    .tag-selected {
        background-color: #3d00a7 !important;
        border: 1px solid #3d00a7 !important;
        opacity: 1 !important;
    }

    .project-tag-search:hover {
        border: 1px solid #888787;
        opacity: 1;
    }

    .project-tag-search:focus, project-tag-search:active {
    }

    .projects-external-container {
        display: flex;
        flex-direction: column;
        padding: 130px 0 50px 0;
        justify-content: center;
        align-items: center;
        gap: 50px;
    }

    .projects-container {
        display: flex;
        gap: 20px;
        justify-content: left;
        align-items: center;
        height: 100%;
        flex-wrap: wrap;
        max-width: 1380px;
        margin-bottom: 50px;
    }

    .project {
        background-color: #121218;
        /*background: linear-gradient(to bottom, #0c0c0f, #080808);*/
        height: 300px;
        width: 260px;
        position: relative;
    }

    .project-content {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
        height: 260px;
    }

    .project-body {
    }

    .project-bar {
        position: absolute;
        bottom: 0;
        height: 2px;
        width: 100%;
        background: linear-gradient(to right, #27006a, #541db1);
    }

    .project-header {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .project-title {
        font-weight: 200;
    }

    .project-mini-description {
        font-weight: 500;
        margin-bottom: 20px;
    }

    .project-tags {
        display: flex;
        gap: 7px;
        flex-wrap: wrap;
    }

    .project-tag {
        font-size: 12px;
        border-radius: 30px;
        background-color: #232332;
        padding: 3px 7px;
        border: 1px solid #4c4d5e;
        opacity: 0.8;
        height: 20px;
        display: flex;
        align-items: center;
        white-space: nowrap;
    }

    .project-links {
        display: flex;
        flex-direction: row;
        gap: 20px;
    }

    .project-link {
        font-size: 13px;
        font-weight: 200;
        display: flex;
        align-items: center;
        line-height: 5px;
        gap: 5px;
        color: #d2d2d2;
        cursor: pointer;
    }

        .project-link img {
            filter: invert(0.5);
            height: 11px;
        }

    @@media screen and (max-width: 1430px) {
        .projects-container {
            max-width: 1100px;
        }
    }

    @@media screen and (max-width: 1150px) {
        .projects-container {
            max-width: 820px;
        }
        /*.search-container {
                    margin: 0 20%;
                }

                .tag-list {
                    margin: 0 15%;
                }*/
    }

    @@media screen and (max-width: 870px) {
        .projects-container {
            max-width: 540px;
        }
    }

    @@media screen and (max-width: 570px) {
        .projects-container {
            justify-content: center;
            /*max-width: 390px;*/
            padding: 0 20px;
        }

        .project-content {
            height: 180px;
        }

        .project {
            height: 220px;
            width: 100%;
        }

        .tag-list {
            width: -moz-available;
            width: -webkit-fill-available;
            width: fill-available;
            margin: 0 30px;
            min-width: unset;
        }

        .search-container {
            width: -moz-available;
            width: -webkit-fill-available;
            width: fill-available;
            margin: 0 30px;
            min-width: unset;
        }
    }
</style>

<script>
    var tagFilter = document.getElementById("tagFilter").value

    document.addEventListener("DOMContentLoaded", () => {
        selectLanguageFlag();
        changeFooterBackground();
    });

    function setTagFilter() {
        document.getElementById("tagFilter").value = tagFilter
        console.log(tagFilter)
    }

    function addOrRemoveSelectedTag(tagName) {
        if (tagFilter.includes(tagName)) {
            removeSelectedTag(tagName)
        }
        else {
            addSelectedTag(tagName)
        }
    }

    function addSelectedTag(tagName) {
        tagFilter = tagFilter + tagName + ';'
        setTagFilter()
        document.getElementById(tagName).className = "project-tag-search tag-selected";
    }

    function removeSelectedTag(tagName) {
        tagFilter = tagFilter.replace(tagName + ';', '');
        setTagFilter()
        document.getElementById(tagName).className = "project-tag-search";
    }

    function changeFooterBackground() {
        document.getElementById("contact-external-container").style.background = "linear-gradient(to right, #060708, #242430)"
    }

    function openVideoModel(videoUrl) {
        document.getElementById("video").src = videoUrl;
        document.getElementById("modal").style.display = "flex";

        setTimeout(() => {
            document.getElementById("modal").style.opacity = "1";
        }, 200)
    }

    function closeVideoModel() {
        document.getElementById("video").src = "";
        document.getElementById("modal").style.opacity = "0";

        setTimeout(() => {
            document.getElementById("modal").style.display = "none";
        }, 200)
    }
</script>